{% extends "layout.html" %}

{% block title %}
    It's a Match!
{% endblock %}

{% block content %}
<div class="results-container">
    <div id="results-intro" class="results-intro">
        <h2>The Results are in..</h2>
    </div>

    <div id="match-content" class="match-content hidden">
        <h1 class="match-header">It's a Match!</h1>

<div class="match-cards-container">
  <!-- GROUP CARD -->
  <div class="group-card match-card">
    <div class="avatar-stack">
      {% for guest in room.guests %}
      <div class="stacked-avatar" title="{{ guest.Username }}">
        {{ guest.Username[0] | upper }}
      </div>
      {% endfor %}
    </div>
    <h3 class="match-card__title">Your Group</h3>
    <p class="match-card__meta">{{ room.Location }}</p>
  </div>

  <!-- RESTAURANT CARD -->
  {% if winning_restaurant %}
  <div class="restaurant-card match-card">
    <img
      class="match-card__photo"
      src="{{ winning_restaurant.image_url }}"
      alt="Image of {{ winning_restaurant.name }}"
    >
    <h3 class="match-card__title">{{ winning_restaurant.name }}</h3>
    <p class="match-card__meta">‚≠ê {{ winning_restaurant.rating }} ({{ winning_restaurant.review_count }} reviews)</p>
    <p class="match-card__meta">
      Price: {{ '$' * winning_restaurant.price_level if winning_restaurant.price_level else 'N/A' }}
    </p>
  </div>
  {% else %}
  <div class="restaurant-card match-card">
    <h3 class="match-card__title">No Clear Winner</h3>
    <p class="match-card__meta">Looks like it was a tough choice!</p>
  </div>
  {% endif %}
</div>

        <div class="results-actions">
            {% if winning_restaurant %}
                <a href="{{ winning_restaurant.url }}" target="_blank" class="button-primary">View Details & Map</a>
            {% endif %}
            <button id="show-details-btn" class="button-secondary">See How Everyone Voted</button>
        </div>


        
        <div id="voting-summary" class="voting-summary hidden">
            <h2 class="animated-subtitle">Voting Summary</h2>
            <table class="voting-summary-table">
                <thead>
                    <tr>
                        <th>User</th>
                        {% for restaurant in restaurant_names %}
                            <th>{{ restaurant }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for user, votes in user_votes.items() %}
                        <tr>
                            <td>{{ user }}</td>
                            {% for restaurant in restaurant_names %}
                                <td>
                                    {% set vote = votes.get(restaurant) %}
                                    {% if vote == 1 %} ‚ù§Ô∏è Yum {% elif vote == 0 %} ü§î Meh {% elif vote == -1 %} ü§¢ Ew {% else %} - {% endif %}
                                </td>
                            {% endfor %}
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const intro = document.getElementById('results-intro');
        const matchContent = document.getElementById('match-content');
        const showDetailsBtn = document.getElementById('show-details-btn');
        const votingSummary = document.getElementById('voting-summary');

        // Show the intro animation, then reveal the results
        setTimeout(() => {
            intro.style.display = 'none';
            matchContent.classList.remove('hidden');
        }, 2500);

        // Add click event to the "Show Details" button
        showDetailsBtn.addEventListener('click', () => {
            votingSummary.classList.toggle('hidden');
            showDetailsBtn.textContent = votingSummary.classList.contains('hidden') ? 'See How Everyone Voted' : 'Hide Voting Details';
        });
    });
</script>
{% endblock %}